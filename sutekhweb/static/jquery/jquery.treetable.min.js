(function(e){"use strict";var n=function(){function t(t,n,s){var o;this.row=t,this.tree=n,this.settings=s,this.id=this.row.data(this.settings.nodeIdAttr),o=this.row.data(this.settings.parentIdAttr),o!=null&&o!==""&&(this.parentId=o),this.treeCell=e(this.row.children(this.settings.columnElType)[this.settings.column]),this.expander=e(this.settings.expanderTemplate),this.indenter=e(this.settings.indenterTemplate),this.cell=e(this.settings.cellTemplate),this.children=[],this.initialized=!1,this.treeCell.prepend(this.indenter),this.treeCell.wrapInner(this.cell)}return t.prototype.addChild=function(e){return this.children.push(e)},t.prototype.ancestors=function(){e=this,t=[];for(var e,t;e=e.parentNode();)t.push(e);return t},t.prototype.collapse=function(){return this.collapsed()?this:(this.row.removeClass("expanded").addClass("collapsed"),this._hideChildren(),this.expander.attr("title",this.settings.stringExpand),this.initialized&&this.settings.onNodeCollapse!=null&&this.settings.onNodeCollapse.apply(this),this)},t.prototype.collapsed=function(){return this.row.hasClass("collapsed")},t.prototype.expand=function(){return this.expanded()?this:(this.row.removeClass("collapsed").addClass("expanded"),this.initialized&&this.settings.onNodeExpand!=null&&this.settings.onNodeExpand.apply(this),e(this.row).is(":visible")&&this._showChildren(),this.expander.attr("title",this.settings.stringCollapse),this)},t.prototype.expanded=function(){return this.row.hasClass("expanded")},t.prototype.hide=function(){return this._hideChildren(),this.row.hide(),this},t.prototype.isBranchNode=function(){return this.children.length>0||this.row.data(this.settings.branchAttr)===!0},t.prototype.updateBranchLeafClass=function(){this.row.removeClass("branch"),this.row.removeClass("leaf"),this.row.addClass(this.isBranchNode()?"branch":"leaf")},t.prototype.level=function(){return this.ancestors().length},t.prototype.parentNode=function(){return this.parentId!=null?this.tree[this.parentId]:null},t.prototype.removeChild=function(t,n){var s=e.inArray(t,this.children),o=this.children.splice(s,1);return n&&!this.children.length&&(this.row.data(this.settings.branchAttr,!1),this.indenter.html("")),o},t.prototype.render=function(){var n,s,t=this.settings;return t.expandable===!0&&this.isBranchNode()&&(n=function(n){return e(this).parents("table").treetable("node",e(this).parents("tr").data(t.nodeIdAttr)).toggle(),n.preventDefault()},this.indenter.html(this.expander),s=t.clickableNodeNames===!0?this.treeCell:this.expander,s.off("click.treetable").on("click.treetable",n),s.off("keydown.treetable").on("keydown.treetable",function(e){e.keyCode==13&&n.apply(this,[e])})),this.indenter[0].style.paddingLeft=""+this.level()*t.indent+"px",this},t.prototype.reveal=function(){return this.parentId!=null&&this.parentNode().reveal(),this.expand()},t.prototype.setParent=function(e){return this.parentId!=null&&this.tree[this.parentId].removeChild(this),this.parentId=e.id,this.row.data(this.settings.parentIdAttr,e.id),e.addChild(this)},t.prototype.show=function(){return this.initialized||this._initialize(),this.row.show(),this.expanded()&&this._showChildren(),this},t.prototype.toggle=function(){return this.expanded()?this.collapse():this.expand(),this},t.prototype._hideChildren=function(){var e,t,n,s=this.children,o=[];for(e=0,n=s.length;e<n;e++)t=s[e],o.push(t.hide());return o},t.prototype._initialize=function(){var e=this.settings;return this.render(),e.expandable===!0&&e.initialState==="collapsed"?this.collapse():this.expand(),e.onNodeInitialized!=null&&e.onNodeInitialized.apply(this),this.initialized=!0},t.prototype._showChildren=function(){var e,t,n,s=this.children,o=[];for(e=0,n=s.length;e<n;e++)t=s[e],o.push(t.show());return o},t}(),s=function(){function t(e,t){this.table=e,this.settings=t,this.tree={},this.nodes=[],this.roots=[]}return t.prototype.collapseAll=function(){var e,t,n,s=this.nodes,o=[];for(e=0,n=s.length;e<n;e++)t=s[e],o.push(t.collapse());return o},t.prototype.expandAll=function(){var e,t,n,s=this.nodes,o=[];for(e=0,n=s.length;e<n;e++)t=s[e],o.push(t.expand());return o},t.prototype.findLastNode=function(e){return e.children.length>0?this.findLastNode(e.children[e.children.length-1]):e},t.prototype.loadRows=function(t){var s,o,i;if(t!=null)for(o=0;o<t.length;o++)i=e(t[o]),i.data(this.settings.nodeIdAttr)!=null&&(s=new n(i,this.tree,this.settings),this.nodes.push(s),this.tree[s.id]=s,s.parentId!=null&&this.tree[s.parentId]?this.tree[s.parentId].addChild(s):this.roots.push(s));for(o=0;o<this.nodes.length;o++)s=this.nodes[o].updateBranchLeafClass();return this},t.prototype.move=function(t,n){var s=t.parentNode();return t!==n&&n.id!==t.parentId&&e.inArray(t,n.ancestors())===-1&&(t.setParent(n),this._moveRows(t,n),t.parentNode().children.length===1&&t.parentNode().render()),s&&s.updateBranchLeafClass(),t.parentNode()&&t.parentNode().updateBranchLeafClass(),t.updateBranchLeafClass(),this},t.prototype.removeNode=function(t){return this.unloadBranch(t),t.row.remove(),t.parentId!=null&&t.parentNode().removeChild(t),delete this.tree[t.id],this.nodes.splice(e.inArray(t,this.nodes),1),this},t.prototype.render=function(){var e,t,n,s=this.roots;for(e=0,n=s.length;e<n;e++)t=s[e],t.show();return this},t.prototype.sortBranch=function(e,t){return e.children.sort(t),this._sortChildRows(e),this},t.prototype.unloadBranch=function(e){var t,n=e.children.slice(0);for(t=0;t<n.length;t++)this.removeNode(n[t]);return e.children=[],e.updateBranchLeafClass(),this},t.prototype._moveRows=function(e,t){var n,s=e.children;e.row.insertAfter(t.row),e.render();for(n=s.length-1;n>=0;n--)this._moveRows(s[n],e)},t.prototype._sortChildRows=function(e){return this._moveRows(e,e)},t}(),t={init:function(t,n){var o=e.extend({branchAttr:"ttBranch",clickableNodeNames:!1,column:0,columnElType:"td",expandable:!1,expanderTemplate:"<a href='#'>&nbsp;</a>",indent:19,indenterTemplate:"<span class='indenter'></span>",cellTemplate:"",initialState:"collapsed",nodeIdAttr:"ttId",parentIdAttr:"ttParentId",stringExpand:"Expand",stringCollapse:"Collapse",onInitialized:null,onNodeCollapse:null,onNodeExpand:null,onNodeInitialized:null},t);return this.each(function(){var t,i=e(this);return(n||i.data("treetable")===void 0)&&(t=new s(this,o),t.loadRows(this.rows).render(),i.addClass("treetable").data("treetable",t),o.onInitialized!=null&&o.onInitialized.apply(t)),i})},destroy:function(){return this.each(function(){return e(this).removeData("treetable").removeClass("treetable")})},collapseAll:function(){return this.data("treetable").collapseAll(),this},collapseNode:function(e){var t=this.data("treetable").tree[e];if(t)t.collapse();else throw new Error("Unknown node '"+e+"'");return this},expandAll:function(){return this.data("treetable").expandAll(),this},expandNode:function(e){var t=this.data("treetable").tree[e];if(t)t.initialized||t._initialize(),t.expand();else throw new Error("Unknown node '"+e+"'");return this},loadBranch:function(t,n){var s,o=this.data("treetable").settings,i=this.data("treetable").tree;return n=e(n),t==null?this.append(n):(s=this.data("treetable").findLastNode(t),n.insertAfter(s.row)),this.data("treetable").loadRows(n),n.filter("tr").each(function(){i[e(this).data(o.nodeIdAttr)].show()}),t!=null&&t.render().expand(),this},move:function(e,t){var s=this.data("treetable").tree[e],n=this.data("treetable").tree[t];return this.data("treetable").move(s,n),this},node:function(e){return this.data("treetable").tree[e]},removeNode:function(e){var t=this.data("treetable").tree[e];if(t)this.data("treetable").removeNode(t);else throw new Error("Unknown node '"+e+"'");return this},reveal:function(e){var t=this.data("treetable").tree[e];if(t)t.reveal();else throw new Error("Unknown node '"+e+"'");return this},sortBranch:function(t,n){var s,i,o=this.data("treetable").settings;return n=n||o.column,s=n,e.isNumeric(n)&&(s=function(t,s){var o=function(t){var s=t.row.find("td:eq("+n+")").text();return e.trim(s).toUpperCase()},i=o(t),a=o(s);return i<a?-1:i>a?1:0}),this.data("treetable").sortBranch(t,s),this},unloadBranch:function(e){return this.data("treetable").unloadBranch(e),this}};e.fn.treetable=function(n){return t[n]?t[n].apply(this,Array.prototype.slice.call(arguments,1)):typeof n=="object"||!n?t.init.apply(this,arguments):e.error("Method "+n+" does not exist on jQuery.treetable")},window.TreeTable||(window.TreeTable={}),window.TreeTable.Node=n,window.TreeTable.Tree=s})(jQuery)